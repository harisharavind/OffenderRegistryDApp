<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Offender Registry</title>

  <link href="css/app.css" rel="stylesheet">
  <link href="css/index.css" rel="stylesheet">
  <link rel="stylesheet"href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.14.1/css/mdb.min.css" rel="stylesheet"/>
</head>

<body>

  <main class="container-fluid">
    <header>
        <div id="logo-container">
          <h1 id="logo-text" class="text-center">
            Offender Registry
          </h1>
        </div>
      </header>
      <section>
        <div class="row">
          <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 col-12">
            <p class="info-text alert alert-primary">
              Network: <span class="network"></span>
            </p>
          </div>

          <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 col-12">
            <p class="info-text alert alert-secondary">
              ChainId: <span class="chainId"></span>
            </p>
          </div>

          <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 col-12">
            <p class="info-text alert alert-success">
              Accounts: <span class="accounts"></span>
            </p>
          </div>
        </div>
      </section>

      <section>
        <div class="row d-flex justify-content-center">
          <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 col-12">
            <div class="card">
              <div class="card-body">
                <h4 class="card-title">
                  Basic Actions
                </h4>

                <button class="btn btn-primary btn-lg btn-block mb-3"
                  id="connectButton">
                  Connect
                </button>

                <button
                  class="btn btn-primary btn-lg btn-block mb-3"
                  id="getCountButton">
                  Get Offenders Count
                </button>

                <p class="info-text alert alert-secondary">
                  Number of Offenders: <span id="Count"></span>
                </p>

                <button
                  class="btn btn-primary btn-lg btn-block mb-3"
                  id="getOffendersListButton">
                  Get Offenders Details
                </button>

                <p class="info-text alert alert-secondary">
                  Offenders details: <span id="OffendersList"></span>
                </p>

                <button
                  class="btn btn-primary btn-lg btn-block mb-3"
                  id="registerNewOffender"
                   data-bs-toggle="modal" href="#exampleModalCenter">
                  Register a new offender
                </button>

              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="registerNewOffender-content">
        <div class="row d-flex justify-content-center">
          <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 col-12">
            <div class="card" id="inputCardGroup">
              <div class="card-body">

                <h4 class="card-title">
                  Provide Offender Details
                </h4>

                <form class="row g-3 needs-validation" novalidate>

                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Name</span>
                  </div>
                  <input type="text" class="form-control" required id="name" placeholder="name" aria-label="name" aria-describedby="basic-addon1">
                </div>

                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Passport Number</span>
                  </div>
                  <input type="text" class="form-control" required id="passportNumber" placeholder="passportNumber" aria-label="passportNumber" aria-describedby="basic-addon1">
                </div>

                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Passport Country</span>
                  </div>
                  <input type="text" class="form-control" required id="passportCountry" placeholder="passportCountry" aria-label="passportCountry" aria-describedby="basic-addon1">
                </div>

                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Blacklist Country</span>
                  </div>
                  <input type="text" class="form-control" required id="blacklistCountry" placeholder="blacklistCountry" aria-label="blacklistCountry" aria-describedby="basic-addon1">
                </div>

                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">Offence Category</span>
                  </div>
                  <input type="text" class="form-control" required id="offenceCategory" placeholder="offenceCategory" aria-label="offenceCategory" aria-describedby="basic-addon1">
                </div>

                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="basic-addon1">IPFS Document Link</span>
                  </div>
                  <input type="text" class="form-control" id="ipfsDocumentLink" placeholder="ipfsDocumentLink" aria-label="ipfsDocumentLink" aria-describedby="basic-addon1" required>
                </div>

                <div class="input-group mb-3">
                  <button
                    class="btn btn-primary btn-lg btn-block mb-3"
                    id="submitNewOffender" type="submit">
                    submit
                  </button>
                </div>

                </form>

                <p class="info-text alert alert-secondary">
                  Txn Hash: <span id="txnHash"></span>
                </p>

              </div>
            </div>
          </div>
        </div>
      </section>



  </main>

  <!-- Error Modal -->
  <div class="modal fade" id="exampleModalCenter" >
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Alert!</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
  </div>

  <dialog id="myDialog">
    <div class="modal-header">
      <h5 class="modal-title" id="exampleModalLongTitle">Alert!</h5>
    </div>
    <div class="modal-body">
      <p class="info-text alert alert-primary">
        <span id="modal-text"></span>
      </p>
    </div>
    <div class="modal-footer">
      <button type="button" id="modalCloseButton" class="btn btn-secondary" data-dismiss="modal">Close</button>
    </div>

  </dialog>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="js/bootstrap.min.js"></script>
  <script src="js/web3.min.js"></script>
  <script src="js/app-or.js"></script>
  <script type="text/javascript">
    const registerNewOffenderContent = document.querySelector('#registerNewOffender-content');

    const connectButton = document.querySelector('#connectButton');
    const getCountButton = document.querySelector('#getCountButton');
    const getOffendersListButton = document.querySelector('#getOffendersListButton');
    const registerNewOffenderButton = document.querySelector('#registerNewOffender');
    const submitNewOffenderButton = document.querySelector('#submitNewOffender');
    const modalCloseButton = document.querySelector('#modalCloseButton');

    const connectedNetwork = document.querySelector('.network');
    const connectedChainId = document.querySelector('.chainId');
    const connectedAccount = document.querySelector('.accounts');

    const sendEthButton = document.querySelector('.sendEthButton');
    const encodeDataButton = document.querySelector('.encodeData');

    let accounts = [];

    connectButton.addEventListener('click', () => {
      getAccount();
    });

    getCountButton.addEventListener('click', () => {
      App.displayCount();
    });

    getOffendersListButton.addEventListener('click', () => {
      App.displayOffendersList();
    });

    modalCloseButton.addEventListener('click', () => {
      modalToggle = document.getElementById('myDialog') // relatedTarget
      modalToggle.close();
    });

    registerNewOffenderButton.addEventListener('click', () => {
      if(accounts.length==0){
        console.log('no account linked');
        document.getElementById('modal-text').innerHTML = 'Please link your account first !..';
        modalToggle = document.getElementById('myDialog') // relatedTarget
        modalToggle.show();

      } else {
        console.log('no account linked');
        document.getElementById('registerNewOffender-content').style.display='block';
    }
    });

    submitNewOffenderButton.addEventListener('click', () => {
      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      var forms = document.querySelectorAll('.needs-validation');

      // Loop over them and prevent submission
      Array.prototype.slice.call(forms)
        .forEach(function (form) {
          form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
              event.preventDefault()
              event.stopPropagation()
            } else {
              App.encodeCreateOffenders();
            }

            form.classList.add('was-validated')
          }, false)
        });

    });


    async function getAccount() {
      const connectbool = ethereum.isConnected();
      const chainId = await ethereum.request({method: 'eth_chainId'});
      const networkId = await ethereum.request({method: 'net_version'});
      accounts = await ethereum.request({ method: 'eth_requestAccounts' });
      const account = accounts[0];
      connectedNetwork.innerHTML = networkId;
      connectedChainId.innerHTML = chainId;
      connectedAccount.innerHTML = account;
      $('#connectButton').attr('disabled','disabled');
      //$('#Button').removeAttr('disabled');
    }

  </script>
</body>

</html>
